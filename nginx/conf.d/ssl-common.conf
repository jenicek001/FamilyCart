# Common SSL/TLS Configuration for FamilyCart Production
# Based on: NGINX best practices + 2025 security standards + Cloudflare optimization
# File: /etc/nginx/conf.d/ssl-common.conf

# Modern SSL protocols only (TLSv1.2 and TLSv1.3)
ssl_protocols TLSv1.2 TLSv1.3;

# Modern cipher suite (prioritizing forward secrecy and AEAD ciphers)
# Based on Mozilla "Intermediate" compatibility (2025) + CHACHA20-POLY1305
ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';

# Server preference for cipher selection (recommended by NGINX for better security)
ssl_prefer_server_ciphers off;

# SSL session cache for performance (50MB shared cache, stores ~200,000 sessions)
ssl_session_cache shared:SSL:50m;

# SSL session timeout (1 day for balance between security and performance)
ssl_session_timeout 1d;

# Disable SSL session tickets (potential security risk, forward secrecy issue)
ssl_session_tickets off;

# OCSP Stapling for faster SSL handshake and privacy
ssl_stapling on;
ssl_stapling_verify on;

# Cloudflare DNS resolvers (faster and more private than Google DNS)
# IPv4: 1.1.1.1, 1.0.0.1
# IPv6: 2606:4700:4700::1111, 2606:4700:4700::1001
# Timeout: 5s, Valid: 300s (5 minutes)
resolver 1.1.1.1 1.0.0.1 [2606:4700:4700::1111] [2606:4700:4700::1001] valid=300s;
resolver_timeout 5s;

# Security: Hide NGINX version
server_tokens off;

# Buffer size optimization (default is 16k, reduce for latency-sensitive applications)
ssl_buffer_size 8k;

# Note: HSTS is set per-site in server blocks to allow per-domain customization
